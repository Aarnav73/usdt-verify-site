<input type="number" id="amountInput" placeholder="Enter amount to verify" style="margin-top: 10px; padding: 6px;" />
<button onclick="verifyAmount()" style="padding: 6px 12px; margin-left: 6px;">Verify</button>
<div id="result" style="margin-top: 15px;"></div>

<script>
  const USDT_CONTRACTS = {
    ethereum: {
      chainId: '0x1',
      name: 'Ethereum Mainnet',
      rpc: 'https://mainnet.infura.io/v3/',
      address: '0xdAC17F958D2ee523a2206206994597C13D831ec7'
    },
    bsc: {
      chainId: '0x38',
      name: 'Binance Smart Chain',
      rpc: 'https://bsc-dataseed.binance.org/',
      address: '0x55d398326f99059fF775485246999027B3197955'
    },
    polygon: {
      chainId: '0x89',
      name: 'Polygon Mainnet',
      rpc: 'https://polygon-rpc.com',
      address: '0x3813e82e6f7098b9583FC0F33a962D02018B6803'
    }
  };

  const USDT_ABI = [
    "function balanceOf(address) view returns (uint256)",
    "function decimals() view returns (uint8)"
  ];

  let highestBalance = 0;
  let connectedAddress = "";

  async function connectWallet() {
    const resultDiv = document.getElementById("result");

    if (!window.ethereum) {
      alert("Please install MetaMask or open this link inside Trust Wallet.");
      return;
    }

    try {
      const provider = new ethers.providers.Web3Provider(window.ethereum, "any");
      await provider.send("eth_requestAccounts", []);
      const signer = provider.getSigner();
      connectedAddress = await signer.getAddress();

      resultDiv.innerHTML = `üîÑ Checking USDT balances for <b>${connectedAddress}</b>...<br><br>`;

      highestBalance = 0;
      let allBalances = [];

      for (const [key, net] of Object.entries(USDT_CONTRACTS)) {
        const customProvider = new ethers.providers.JsonRpcProvider(net.rpc);
        const usdt = new ethers.Contract(net.address, USDT_ABI, customProvider);

        try {
          const balanceRaw = await usdt.balanceOf(connectedAddress);
          const decimals = await usdt.decimals();
          const balance = parseFloat(ethers.utils.formatUnits(balanceRaw, decimals)).toFixed(2);
          allBalances.push(`üü¢ ${net.name}: <b>${balance} USDT</b>`);
          highestBalance = Math.max(highestBalance, parseFloat(balance));
        } catch (err) {
          allBalances.push(`üî¥ ${net.name}: <i>Unable to check balance</i>`);
        }
      }

      resultDiv.innerHTML += allBalances.join("<br>");
    } catch (err) {
      console.error(err);
      resultDiv.innerHTML = "‚ùå Failed to connect wallet or fetch balances.";
    }
  }

  function verifyAmount() {
    const input = document.getElementById("amountInput").value;
    const resultDiv = document.getElementById("result");

    if (!connectedAddress || highestBalance === 0) {
      alert("Please connect your wallet first.");
      return;
    }

    if (!input || isNaN(input) || parseFloat(input) <= 0) {
      resultDiv.innerHTML += `<br><div class="not-verified">‚ùå Invalid amount entered.</div>`;
      return;
    }

    if (parseFloat(input) <= highestBalance) {
      resultDiv.innerHTML += `<br><div class="verified">‚úÖ Verified: You have enough USDT.</div>`;
    } else {
      resultDiv.innerHTML += `<br><div class="not-verified">‚ùå Not Verified: You don't have enough USDT.</div>`;
    }
  }

  window.addEventListener('DOMContentLoaded', () => {
    setTimeout(() => {
      if (window.ethereum && /MetaMask|Trust/.test(navigator.userAgent)) {
        connectWallet();
      }
    }, 1500);
  });
</script>
